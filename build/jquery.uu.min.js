/*!
 * jQuery UU-JS Plugin v1.0.0
 * 
 * http://netprotect.com
 * 
 * Copyright (c) 2018 NetProtect
 * Released under the MIT license
 */

!function($){"use strict";$.UUJS=function(options){function _defaultArgs(args){var merged={};if(""===plugin.settings.key)throw new Error("Missing key");return $.extend(merged,{key:plugin.settings.key}),plugin.settings.reseller_id&&$.extend(merged,{reseller_id:plugin.settings.reseller_id}),cache&&$.each(["ip","account_id","email"],function(n,idx){cache[idx]&&(merged[idx]=cache[idx])}),$.extend(merged,args),merged}function _getStatus(args){return $.ajax({url:plugin.settings.url,data:_defaultArgs(args),dataType:"jsonp",cache:!1,timeout:plugin.settings.timeout,tryCount:0,retryLimit:plugin.settings.retry,beforeSend:function(xhr,opts){publishEvent("onStart",[])},success:function(data){publishEvent("onSuccess",[data]),cache=data},always:function(){},error:function(xhr,status,error){publishEvent("onFail",[xhr,status,error]),"timeout"===status&&this.retryLimit>0&&++this.tryCount<this.retryLimit&&$.ajax(this)}})}function _setStatus(args,url,callback){return $.ajax({url:url,data:_defaultArgs(args),async:!1,dataType:"jsonp",beforeSend:function(xhr,opts){publishEvent("onStart",[])},success:function(data){publishEvent("onSuccess",[data]),"function"==typeof callback&&callback(),_getStatus()},error:function(xhr,status,error){publishEvent("onFail",[xhr,status,error])}})}var subscribeEvent,unsubscribeEvent,publishEvent,ip,defaults={url:"https://dragon-check.unblock-us.com/get-status.js",timeout:3e3,retry:3,key:"",reseller_id:""},plugin=this,cache=null,handlers={};return plugin.settings={},subscribeEvent=function(event,callback){if("object"!=typeof event)return handlers[event]||(handlers[event]=[]),handlers[event].push(callback),[event,callback];var res=[];for(var m in event)"function"==typeof event[m]&&(res.push(m),subscribeEvent(m,event[m]))},unsubscribeEvent=function(handler){var t=handler[0],i=handlers[t].length-1;if(handlers[t])for(i;i>=0;i-=1)handlers[t][i]===handler[1]&&handlers[t].splice(i,1)},publishEvent=function(event,args){return null!==handlers[event]&&($.each(handlers[event],function(){this.apply(plugin,args||[])}),!0)},ip=function(){if(0===arguments.length)return Boolean(cache.ip);_setStatus({reactivate:1},plugin.settings.url)},function(){plugin.settings=$.extend({},defaults,options)}(),{subscribe:subscribeEvent,unsubscribe:unsubscribeEvent,status:_getStatus,ip:ip}}}($);