/*!
 * jQuery UU-JS Plugin v1.0.0
 * 
 * http://netprotect.com
 * 
 * Copyright (c) 2017 NetProtect
 * Released under the MIT license
 */

!function($){"use strict";$.UUJS=function(options){function _generateServerUrl(){var url=plugin.settings.url,cacheIndex=7;return"https:"===location.protocol?url.replace(/^http:\/\//i,"https://"):url.slice(0,cacheIndex)+"c"+Math.floor(1e6*Math.random()+1)+"."+url.slice(cacheIndex)}function _getStatus(args){if(""===plugin.settings.key)throw new Error("Missing key");return $.extend(args,{key:plugin.settings.key}),$.ajax({url:_generateServerUrl(),data:args,dataType:"jsonp",cache:!1,timeout:plugin.settings.timeout,tryCount:0,retryLimit:plugin.settings.retry,beforeSend:function(xhr,opts){publishEvent("onStart",[])},success:function(data){publishEvent("onSuccess",[data]),cache=data},always:function(){},error:function(xhr,status,error){publishEvent("onFail",[xhr,status,error]),"timeout"===status&&this.retryLimit>0&&++this.tryCount<this.retryLimit&&$.ajax(this)}})}function _setStatus(args,url,callback){return $.ajax({url:url,data:args,async:!1,dataType:"jsonp",beforeSend:function(xhr,opts){publishEvent("onStart",[])},success:function(data){publishEvent("onSuccess",[data]),"function"==typeof callback&&callback(),_getStatus()},error:function(xhr,status,error){publishEvent("onFail",[xhr,status,error])}})}var subscribeEvent,unsubscribeEvent,publishEvent,ip,defaults={url:"//dragon-check.unblock-us.com/get-status.js",timeout:3e3,retry:3,key:""},plugin=this,cache=null,handlers={};return plugin.settings={},subscribeEvent=function(event,callback){if("object"!=typeof event)return handlers[event]||(handlers[event]=[]),handlers[event].push(callback),[event,callback];var res=[];for(var m in event)"function"==typeof event[m]&&(res.push(m),subscribeEvent(m,event[m]))},unsubscribeEvent=function(handler){var t=handler[0],i=handlers[t].length-1;if(handlers[t])for(i;i>=0;i-=1)handlers[t][i]===handler[1]&&handlers[t].splice(i,1)},publishEvent=function(event,args){return null!==handlers[event]&&($.each(handlers[event],function(){this.apply(plugin,args||[])}),!0)},ip=function(){if(0===arguments.length)return Boolean(cache.ip);_setStatus({reactivate:1},_generateServerUrl())},function(){plugin.settings=$.extend({},defaults,options)}(),{subscribe:subscribeEvent,unsubscribe:unsubscribeEvent,status:_getStatus,ip:ip}}}($);